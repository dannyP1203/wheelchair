<?xml version="1.0"?>

<robot xmlns:xacro="http://www.ros.org/wiki/xacro">
	
	<!-- Wheels-->
	
	<!-- Inertia matrix -->
	<xacro:macro name="cylinder_inertia" params="m r h">
		<inertia  ixx="${m*(3*r*r+h*h)/12}" ixy = "0" ixz = "0" iyy="${m*(3*r*r+h*h)/12}" iyz = "0" izz="${m*r*r/2}" /> 
	</xacro:macro>

	
	<xacro:macro name="wheel" params="lr parent translateX translateY translateZ flipY"> <!-- lr: left, right -->
		<link name="${lr}_wheel">
			<visual>
				<origin xyz="0 0 0" rpy="${flipY*M_PI/2} 0  0 " /> 
				<geometry>
					<cylinder length="${wheel_height}" radius="${wheel_radius}" />
				</geometry>
				<material name="grey"><color rgba="0.4 0.4 0.4 1"/></material>
			</visual>
			<collision>
				<origin xyz="0 0 0" rpy="${flipY*M_PI/2} 0 0" />
				<geometry><cylinder length="${wheel_height}" radius="${wheel_radius}" /></geometry>
			</collision>
			<inertial>
				<mass value="${wheel_mass}" />
				<origin xyz="0 0 0" />
				<xacro:cylinder_inertia  m="${wheel_mass}" r="${wheel_radius}" h="${wheel_height}" />
			</inertial>
		</link>

		<joint name="${lr}_wheel_joint" type="continuous">
			<parent link="${parent}"/>
			<child link="${lr}_wheel"/>
			<origin xyz="${translateX} ${translateY} ${translateZ}" rpy="0 0 0" /> 
			<axis xyz="0 1 0" />
			<limit effort="100.0" lower="0.0" upper="0.0" velocity="100"/>
			<joint_properties damping="0.0" friction="0.0"/>
		</joint>
    </xacro:macro>
	
	<xacro:wheel lr="right" parent="base_link" translateX="-0.15" translateY="-0.3" translateZ="-0.05" flipY="1" />
	<xacro:wheel lr="left" parent="base_link" translateX="-0.15" translateY="0.3" translateZ="-0.05" flipY="1" />
	
	
	<!-- Caster -->
	<xacro:macro name="caster" params="lr parent translateX translateY translateZ"> <!-- lr: left, right -->
		<link name="${lr}_caster">
			<visual>
				<origin xyz="0 0 0" rpy="0 0  0 " /> 
				<geometry>
					<sphere radius="${caster_radius}" />
				</geometry>
				<material name="grey"><color rgba="0.4 0.4 0.4 1"/></material>
			</visual>
			<collision>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<geometry><sphere radius="${caster_radius}" /></geometry>
			</collision>
			<inertial>
				<mass value="${caster_mass}"/>
				<inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001"/>
			</inertial>
		</link>

		<joint name="${lr}_caster_joint" type="continuous">
			<parent link="${parent}"/>
			<child link="${lr}_caster"/>
			<origin xyz="${translateX} ${translateY} ${translateZ}" rpy="0 0 0" /> 
			<axis xyz="0 1 0" />
		</joint>
    </xacro:macro>
	
	<xacro:caster lr="left" parent="base_link" translateX="0.375" translateY="-0.275" translateZ="-0.15" />
	<xacro:caster lr="right" parent="base_link" translateX="0.375" translateY="0.275" translateZ="-0.15" />
	
	
	<!-- Top -->
	<xacro:macro name="top" params="lr parent translateX translateY translateZ"> <!-- lr: left, right -->
		<link name="${lr}_top">
			<visual>
				<origin xyz="0 0 0" rpy="0 0  0 " /> 
				<geometry>
					<cylinder length="${top_height}" radius="${top_radius}" />
				</geometry>
				<material name="white"><color rgba="1 1 1 1"/></material>
			</visual>
			<collision>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<geometry><cylinder length="${top_height}" radius="${top_radius}" /></geometry>
			</collision>
			<inertial>
				<mass value="${top_mass}" />
				<origin xyz="0 0 0" />
				<xacro:cylinder_inertia  m="${top_mass}" r="${top_radius}" h="${top_height}" />
			</inertial>
		</link>

		<joint name="${lr}_top_joint" type="continuous">
			<parent link="${parent}"/>
			<child link="${lr}_top"/>
			<origin xyz="${translateX} ${translateY} ${translateZ}" rpy="0 0 0" /> 
			<axis xyz="0 0 1" />
			<limit effort="100.0" lower="0.0" upper="0.0" velocity="100"/>
			<joint_properties damping="0.0" friction="0.0"/>
		</joint>
    </xacro:macro>
	
	<xacro:top lr="left" parent="base_link" translateX="0.375" translateY="-0.275" translateZ="0" />
	<xacro:top lr="right" parent="base_link" translateX="0.375" translateY="0.275" translateZ="0" />
	
</robot>

